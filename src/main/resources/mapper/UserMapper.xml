<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.office.yancao.mapper.UserMapper">


    <!--  根据用户ID查询用户  -->
    <select id="getUsersById" resultType="com.office.yancao.entity.User">
        SELECT * FROM user_info WHERE id = #{userId}
    </select>
    <!--  根据用户名查询用户  -->
    <select id="getUserByUsername" resultType="com.office.yancao.entity.User">
        SELECT * FROM user_info WHERE username = #{username}
    </select>
    <!--  插入用户信息  -->
    <insert id="insertUser" parameterType="com.office.yancao.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user_info
    (username, password, phone, position, role, classes, section, party, member, department, support_position, birthday, line )
    VALUES ( #{username}, #{password}, #{phone}, #{position}, #{role}, #{classes}, #{section}, #{party}, #{member}, #{department}, #{support_position}, #{birthday}, #{line} ) </insert>
    <!--  插入用户部门关联关系  -->
    <insert id="insertUserDepartment">
         INSERT INTO user_department ( user_id, department_id )
         VALUES ( #{userId}, #{departmentId} )
     </insert>
    <!--  根据用户ID查询用户所在班级  -->
    <select id="getUserClassById" resultType="java.lang.String">
        SELECT classes FROM user_info WHERE id = #{userId}
    </select>

    <select id="listUsers" resultType="com.office.yancao.entity.User">
        SELECT id, username, password, phone, birthday, position, role, classes, section, line, support_position, party, member, department
        FROM user_info
        WHERE role = 'USER'
    </select>

    <select id="getUserByClass" resultType="java.lang.Long">
        SELECT id
        FROM user_info
        WHERE classes = #{classes}
    </select>

    <select id="getUserByParty" resultType="java.lang.Long">
        SELECT id
        FROM user_info
        WHERE member = #{member}
    </select>

    <select id="selectUserList" parameterType="com.office.yancao.dto.admin.UserQuery" resultType="com.office.yancao.entity.User">
        SELECT
         *
        FROM user_info
        <where>
            <if test="username != null and username != ''">
                AND username LIKE CONCAT('%', #{username}, '%')
            </if>
<!--            <if test="position != null and position != ''">-->
<!--                AND position = #{position}-->
<!--            </if>-->

            <if test="classes != null and classes != '' and classes != 'all'">
                AND classes = #{classes}
            </if>
        </where>
    </select>

    <update id="updateUserInfo" parameterType="com.office.yancao.entity.User">
        UPDATE user_info
        <set>
            <if test="phone != null and phone != ''">phone = #{phone},</if>
            <if test="username != null and username != ''">username = #{username},</if>
            <if test="department != null and department != ''">department = #{department},</if>
            <if test="classes != null and classes != ''">classes = #{classes},</if>
            <if test="line != null and line != ''">line = #{line},</if>
            <if test="section != null and section != ''">section = #{section},</if>
            <if test="position != null and position != ''">position = #{position},</if>
            <if test="party != null and party != ''">party = #{party},</if>
            <if test="member != null and member != ''">member = #{member},</if>
            <if test="supportPosition != null and supportPosition != ''">support_position = #{supportPosition},</if>
            <if test="birthday != null">birthday = #{birthday},</if>

        </set>
        WHERE id = #{id}
    </update>

</mapper>
